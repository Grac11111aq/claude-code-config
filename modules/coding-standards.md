# コーディング標準と品質管理

## 1. 基本原則

<coding_standards>
<rule importance="critical">
**基本原則**: コーディングルールや規則は、一般的なベストプラクティスを遵守し、常にコードの可読性を最優先とする
</rule>

<rule importance="high">
**コメント**: 主要なロジック、複雑なアルゴリズム、あるいは自明ではない設計判断について、その意図や目的を明確にするコメントの生成を期待する
</rule>

<rule importance="high">
**モジュールの粒度**: コードの可読性と保守性を高めるため、1ファイルあたりの責務が単一であることや、1関数が1つのタスクに集中することを意識する。過度に長大なファイルや関数にならないよう、適切なモジュール分割や関数分割を行う
</rule>
</coding_standards>

## 2. 命名規則

**原則**: 各プログラミング言語の標準的な命名規則に従う

| 言語/用途 | 変数・関数 | クラス・型 | 定数 | ファイル名 |
|---------|-----------|----------|------|----------|
| Python | snake_case | PascalCase | UPPER_SNAKE_CASE | snake_case.py |
| JavaScript/TypeScript | camelCase | PascalCase | UPPER_SNAKE_CASE | kebab-case.ts |
| Rust | snake_case | PascalCase | UPPER_SNAKE_CASE | snake_case.rs |
| Go | camelCase（非公開）<br>PascalCase（公開） | PascalCase | PascalCase | snake_case.go |

## 3. エラーハンドリングとロギング

<error_handling_policy>
**エラーハンドリング方針**:
- ユーザー向けメッセージ: 親しみやすく、解決方法を含む
- エラーコード体系: 意味の分かりやすい文字列識別子（例: FILE_NOT_FOUND, NETWORK_ERROR）
- スタックトレース: 開発環境でのみ詳細表示、本番環境では最小限

**ログレベル定義**:
| レベル | 用途 | 例 |
|-------|------|-----|
| DEBUG | 開発時の詳細情報 | 変数の値、処理フロー |
| INFO | 正常な処理の記録 | 起動完了、ファイル保存成功 |
| WARN | 注意が必要な事象 | 非推奨機能の使用、リトライ処理 |
| ERROR | エラー（処理は継続） | ファイル読み込み失敗 |
| FATAL | 致命的エラー（処理停止） | 必須設定ファイルの欠如 |

- 構造化ログ: JSON形式を基本とする
- パフォーマンスメトリクス: 重要な処理の実行時間を自動計測
</error_handling_policy>

## 4. テスト戦略

### 4.1 基本方針
<testing_strategy>
<principle importance="critical">
**品質保証のため、包括的なテスト戦略を採用する。ユニットテストを基本とし、アプリケーションの特性に応じて結合テストやE2Eテストの導入も検討する。**
</principle>

<expectation>
**LLMへの期待**: テストケースの洗い出し（正常系、異常系、境界値など）、テストコードの雛形生成、および既存テストの改善提案などを期待する
</expectation>
</testing_strategy>

### 4.2 段階的テストカバレッジ目標

**フェーズ別目標設定**:

| フェーズ | コア機能 | ユーティリティ | UI・表示 | 全体目標 |
|---------|---------|-------------|----------|----------|
| **MVP** | 60%以上 | 40%以上 | 手動テスト | 50%以上 |
| **β版** | 70%以上 | 50%以上 | スナップショット | 60%以上 |
| **1.0リリース** | 80%以上 | 60%以上 | 自動テスト | 70%以上 |
| **成熟段階** | 90%以上 | 80%以上 | E2Eテスト | 85%以上 |

**段階的品質ゲート**:
- 初期開発段階では実現可能な目標を設定
- プロダクトの成熟に合わせて品質基準を段階的に向上
- 各フェーズで最低限必要な品質を保証

## 5. CI/CD & 品質ゲートの絶対基準

### 5.1 段階的品質チェック基準

<quality_gates>
**フェーズ別CI基準** (プロダクト成熟度に応じた調整):

#### MVP・初期開発段階
| チェック項目 | 基準 | 自動化ツール例 |
|------------|------|--------------||
| **単体テストカバレッジ** | 50%以上（コア機能は60%以上） | Jest, pytest-cov |
| **静的型チェック** | エラー0件 | TypeScript, mypy |
| **リンターエラー** | 0件（警告10件以下） | ESLint, Pylint |
| **セキュリティ脆弱性** | Critical: 0件, High: 2件以下 | npm audit, Snyk |

#### β版・安定化段階  
| チェック項目 | 基準 | 自動化ツール例 |
|------------|------|--------------||
| **単体テストカバレッジ** | 60%以上（コア機能は70%以上） | Jest, pytest-cov |
| **リンターエラー** | 0件（警告5件以下） | ESLint, Pylint |
| **セキュリティ脆弱性** | Critical/High: 0件 | npm audit, Snyk |
| **循環的複雑度** | 関数単位で20以下 | ESLint, Radon |

#### 本番・成熟段階
| チェック項目 | 基準 | 自動化ツール例 |
|------------|------|--------------||
| **単体テストカバレッジ** | 80%以上（コア機能は90%以上） | Jest, pytest-cov |
| **リンターエラー** | 0件（警告は許容） | ESLint, Pylint |
| **コードフォーマット** | 100%準拠 | Prettier, Black |
| **セキュリティ脆弱性** | Critical/High: 0件 | npm audit, Snyk |
| **OWASP Top 10** | 検出0件 | OWASP ZAP, SonarQube |
| **循環的複雑度** | 関数単位で15以下 | ESLint, Radon |
| **重複コード** | 3%以下 | jscpd, SonarQube |

**SLO（本番運用指標）と CI基準の分離**:
- CI基準: 開発段階での合否ライン
- SLO: 本番環境での目標値
- 段階的基準で過剰な品質要求を回避
</quality_gates>

### 5.2 パフォーマンス基準

| メトリクス | 閾値 | 測定方法 |
|----------|------|----------|
| **起動時間** | 1秒以内 | 実機計測 |
| **メモリリーク** | 0件 | Chrome DevTools |
| **バンドルサイズ増加** | コミット毎+5%以内 | webpack-bundle-analyzer |

### 5.3 デプロイメントゲート

本番環境へのデプロイ前に必須：

1. **全自動テスト合格**: 単体・統合・E2Eテストすべて
2. **手動承認**: セキュリティ関連変更時は必須
3. **ロールバック計画**: 文書化必須
4. **監視アラート設定**: エラー率閾値の設定