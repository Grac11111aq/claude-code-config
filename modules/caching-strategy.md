# 💾 キャッシング規約

<module_info>
このモジュールは、キャッシング戦略の規約を定義します。
シンプルで効果的なキャッシング戦略により、パフォーマンスと開発効率のバランスを実現します。
</module_info>

## 📐 基本規約

### キャッシュレイヤー

```yaml
デフォルト構成:
  1. ブラウザキャッシュ（Cache-Control）
  2. CDN（静的アセット）
  3. アプリケーションキャッシュ（Redis）
  4. データベースクエリキャッシュ

採用基準:
  Redis: セッション管理、一時データ、高頻度アクセスデータ
  インメモリ: 小規模・読み取り専用データ
```

## 🕐 TTL（Time To Live）規約

```yaml
静的アセット:
  画像・フォント: 1年
  CSS・JS: デプロイ毎にバージョニング
  
APIレスポンス:
  マスターデータ: 1時間
  ユーザーデータ: 5分
  リアルタイムデータ: キャッシュなし
  
セッション:
  デフォルト: 24時間
  記憶する: 30日
```

## 🔄 キャッシュ無効化

```yaml
戦略:
  タグベース無効化: 推奨（Redis使用時）
  TTLベース: シンプルなケース
  イベント駆動: 更新時に明示的に無効化

実装パターン:
  キーパターン: {service}:{resource}:{id}:{version}
  例: api:users:123:v1
```

## 📊 キャッシュヘッダー

### 静的アセット

```yaml
Cache-Control: public, max-age=31536000, immutable
```

### APIレスポンス

```yaml
# キャッシュ可能
Cache-Control: private, max-age=300
ETag: "33a64df551425fcc55e4d42a148795d9f25f89d4"

# キャッシュ不可
Cache-Control: no-store
```

## 🚀 実装例

### Redis使用時

```javascript
// キーの規約
const cacheKey = `api:${resource}:${id}`;
const cacheTTL = 300; // 5分

// タグ付け（無効化用）
const tags = [`user:${userId}`, `resource:${resource}`];
```

### キャッシュ判断フロー

```yaml
キャッシュすべき:
  - 計算コストが高い
  - 更新頻度が低い
  - 同一リクエストが多い

キャッシュすべきでない:
  - 個人情報
  - リアルタイムデータ
  - 一度きりのデータ
```

## 📈 モニタリング

```yaml
必須メトリクス:
  - キャッシュヒット率
  - レスポンスタイム
  - メモリ使用量
  
目標値:
  ヒット率: 80%以上
  レスポンスタイム改善: 50%以上
```